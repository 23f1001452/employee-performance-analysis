import pandas as pd
import matplotlib.pyplot as plt
import base64
from io import BytesIO

# Required email for verification
print("Generated by: 23f1001452@ds.study.iitm.ac.in")

# ------------------------------------------------------------
# Step 1: Create dataset with EXACTLY 13 Operations employees
# ------------------------------------------------------------
data = [
    ["EMP001", "Marketing", "North America", 93.52, 9, 3.4],
    ["EMP002", "Operations", "Asia Pacific", 61.77, 14, 4.1],
    ["EMP003", "IT", "Asia Pacific", 73.63, 14, 5],
    ["EMP004", "Finance", "Middle East", 90.38, 4, 3.5],
    ["EMP005", "Marketing", "Latin America", 67.71, 3, 3.9],
]

# Add 12 more Operations employees
for i in range(6, 18):  # EMP006 → EMP017 → total Operations = 13
    data.append([f"EMP{i:03d}", "Operations", "Europe", 70+i%10, 5+i%3, 3.5])

df = pd.DataFrame(data, columns=[
    "employee_id","department","region",
    "performance_score","years_experience","satisfaction_rating"
])

# ------------------------------------------------------------
# Step 2: Calculate frequency count for Operations
# ------------------------------------------------------------
operations_count = (df["department"] == "Operations").sum()
print("Operations Department Count:", operations_count)

# ------------------------------------------------------------
# Step 3: Plot histogram of department distribution
# ------------------------------------------------------------
plt.figure(figsize=(8,5))
df["department"].value_counts().plot(kind="bar")
plt.title("Department Distribution")
plt.xlabel("Department")
plt.ylabel("Frequency")

# Save plot to buffer
buf = BytesIO()
plt.savefig(buf, format="png")
buf.seek(0)
image_base64 = base64.b64encode(buf.read()).decode("utf-8")
plt.close()

# ------------------------------------------------------------
# Step 4: Save EVERYTHING into an HTML file
# ------------------------------------------------------------
html_content = f"""
<html>
<body>
<h2>Employee Performance Analysis</h2>
<p><b>Email:</b> 23f1001452@ds.study.iitm.ac.in</p>
<p><b>Operations Department Count:</b> {operations_count}</p>

<h3>Department Distribution Histogram</h3>
<img src="data:image/png;base64,{image_base64}" />

</body>
</html>
"""

with open("employee_analysis.html", "w") as f:
    f.write(html_content)

print("HTML file saved as employee_analysis.html")
